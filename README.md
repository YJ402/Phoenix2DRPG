4조 불4조 궁수의전설 기반 프로젝트

팀장 강연준 : 적, 보스
팀원 표수진 : 맵 (장애물, 아이템 배치)
팀원 김효재 : UI
팀원 김민성 : 플레이어, UI
팀원 한철희 : 스킬



1.개괄

게임 규칙 : 스테이지를 선택하여 라운드마다 활과 화살로 몰려오는 적을 모두 제거하면 클리어,exp를 획득하여 레벨을 높이며 캐릭터 성장

총 3스테이지 (난이도): 스테이지에 비례하여 몹 수 증가
1스테이장 5라운드 : 라운드 비례하여 몹 수 소량 증가, 라운드간 체력초기화x
라운드 클리어시 랜덤하게 등장하는 3개 스킬중 1개 선택하여 획득

5라운드에 보스등장

5라운드 클리어시 스테이지클리어, 스테이지에 비례하여 exp 획득, 일정exp획득시 레벨업
스테이지 끝나면 모든 스킬 초기화

레벨 수 만큼 스테이지 시작할때 스킬 획득하고 시작함 (스킬 랜덤3개등장, 1개선택 반복)

몹 종류 : 근거리(박쥐) 원거리(악마) 보스
몹 사망시 확률적으로 아이템 드랍


1-1.흐름
로비 씬: 스테이지 선택
스킬 선택 창: 랜덤한 액티브/패시브 스킬 3개 중 스킬 포인트만큼 선택
레벨 = 스킬 포인트. 포인트 사용해 스킬 선택
액티브 스킬은 장착 형식
배틀 씬 진입: 장애물, 아이템, 적군 랜덤 배치
(스테이지 하나 당 5라운드, 총 3스테이지)
플레이어 사망 시 게임 오버, 로비로 돌아갈 수 있음
모든 적 사망 시 스킬 창 열람, 출구 앞 장애물 제거






2.배틀씬

2-1.배틀 매니저
3스테이지 * 5라운드 ( ∴ 15라운드)
1.전투 전 UI 호출 -> 2.전투 -> 3.전투 종료 UI 호출
전투 전 UI:
스킬 선택창: BattleUI
전투 
맵 생성:ObstacleManager, 
몹 스폰:EnemyManager
플레이어 데이터 로드
전투 종료 UI
스킬 선택창: BattleUI
=> 라운드 종료 시 배틀 씬 파괴 후 재생성 =>  전역 데이터 관리 필요 =>  PlayerData
PlayerData: 전역 데이터 관리
잔여체력, 현 스테이지, 현 라운드 등 저장/입출력


2-2 맵 내 장애물 자동 생성 로직
 - 범위 설정 InitializeGrid()
 A와 B 오브젝트를 기준으로 그리드 설정.

 - 장애물 배치 (SpawnObstacle)
 장애물 생성 메서드
 
 - 장애물 배치 (AreaAvailable)
 특정 좌표가 배치 가능한 좌표인지 검사
 
 - 장애물 배치 (MarkArea)
 장애물이 배치된 좌표에 숫자로 표시.
 
 - 아이템 배치 (FindEmptySpaces)
 장애물이 없는 좌표 찾기
 
 - 아이템 배치 (PlaceItems)
장애물을 피해 아이템 배치





2-3.Player
공격 애니메이션 내부에 공격판정/투사체 발사 삽입
캐릭터의 기본 스탯 (체력, 속력, 공격력), 애니메이션 속도를 현재 속력/공속에 맞춤
씬 전환 시 파괴 안 되는 PlayerData로 데이터 유지
플레이어 스테이지, 라운드, 레벨, 경험치, 스킬 포인트(=레벨), 체력 저장 및 관리
액티브 스킬, 패시브 스킬 추적 및 적용


2-3-1. 스킬

배틀 시작 전에 랜덤한 스킬 3개 (액티브 + 패시브) 중 택 1
이미 장착 중인 액티브 스킬을 선택하면 업그레이드 됨
다른 액티브 스킬을 선택하면 현재 장착 중인 스킬을 빼고 새 걸로 변경함
스테이지 넘어가면 액티브(능동), 패시브(수동) 스킬 초기화

액티브-
모든 적군에게 지정된 대미지 입히기
공격력 2배 증가
일반 화살을 폭탄 화살로 변경
탄환 개수를 2배로 설정
플레이어 투명화

패시브-
공격 속도 증가
탄환 수 증가
최대 체력 증가
이동 속도 증가

2-4.Enemy
클래스 구조: 
BaseController(플레이어와 공유) -> EnemyController -> Melee / Range / BossController
EnemyManager: 몹 스폰 메서드, 남은 적 리스트로 관리.
공격 및 탐색 판단, 사망 시 아이템 드롭


2-4-1. 경로 탐색 로직
즉시 공격할지/ 탐색할지 탐색
조건: TargetInLine(직선 상) & TargetInDistance(사거리 내)
O => 즉시 공격.
X => BFS탐색 실행. (맵 생성시 산출된 장애물을 피해 플레이어에 도달할 수 있는 경로 탐색)

1.spot에 좌표값 먼저 enqueue
2.while문: 
spots Dequeue -> 목표지점에 도달 여부 검사 -> 도달 시 탐색 종료(break).

<이번 반복에서 도달 실패 => 주변 지점 추가 로직>
1.주변 지점 중 조건을 충족하는 곳만 queue에 추가, 
2.Vector2[,] infoFrom에 기록
Vector2[,] infoFrom? : 맵과 같은 크기의 배열인데, 출신 Vector를 값으로 갖게함.-> BackTracking(역추적)에 사용

<이번 반복에서 도달 성공 => 재귀 함수 BackTracking 경로 역추적>

	 - 기저 사례: BFS의 탐색의 출발지인 finder에 도달하면 재귀 종료. 
	 - 경로 기록: Pop<Vector2> path에 푸쉬.
(경로에서 첫번째 경로만 필요하기 때문에 Pop자료구조 사용)


2-5.보스
각 스테이지의 5라운드에 등장
스킬: 적군 소환,  폭발(전체공격), 순간 이동
랜덤하게 선택하여 사용.

문제점: 보스 스킬 구현에서 스킬을 고르게 사용하지 않는 버그가 발생했는데 시간이 부족하여 픽스하지 못함.









3.트러블 슈팅


트러블슈팅#1


발단: 수진 -> skeleton 브랜치에 깃허브 머지 도중 충돌 사항이 여럿 발견됨. 충돌 사항을 해결하려고 보니 skeleton 또는 origin/skeleton에 머지할 수 있게 되어 있었음
전개: 튜터 님께 찾아가 문의한 결과, 전날 머지했던 부분이 로컬 브랜치(팀원의 컴퓨터)와 원격 브랜치로 나뉘게 된 걸 알게 됨
결말: 충돌된 부분을 전부 원격 브랜치 쪽으로 선택해 충돌 부분 해결
→ 나중에는 스크립트를 메모장에 백업해두고 skeleton 브랜치를 복제해서 쓰는 일도 있었음



트러블슈팅#2


문제 제목: Layer - LayerMask의 혼동 문제 
코드:
targetLayerMask = gameObject.layer;
RaycastHit2D hit = Physics2D.Raycast(position, direction, attackRange, targetLayerMask);
발단: 6번 레이어를 사용하고자 했지만 3번, 2번 레이어가 선택 됨
전개:. Layer(10진수. 단독 사용), LayerMask(2진수. 여러 레이어 정보를 포함).
 LayerMask에 ‘6’을 입력하면 00000110로 인식되어 2,3번 레이어를 의미함
해결 방법: 
targetLayerMask에 LayerMask 타입에 맞는 값을 입력. targetLayerMask = (1 <<gameObject.layer)

기록하지못한 너무 많은 일이있었습니다.. 힘들다 정말...

